# AmbientFlow - 技術仕様書

## プロジェクト概要

**AmbientFlow**は、複数の環境音を同時再生し、各音源の音量を個別に調整できるクロスプラットフォーム対応デスクトップアプリケーション。操作性と安定性を最重視した設計とする。

## 技術選定

### フレームワーク・言語

- **メインフレームワーク**: Tauri v2.x (安定版)
- **フロントエンド**: React 19 + TypeScript 5.8
- **バックエンド**: Rust (最小限)
- **ビルドツール**: Vite

### UI・スタイリング

- **CSSフレームワーク**: TailwindCSS 4.x
- **アニメーション**: Motion (旧Framer Motion) 12.x
- **アイコン**: Lucide React
- **カラーパレット**: ダークテーマベース

### 音声処理

- **音声ライブラリ**: Howler.js 2.x
  - 安定性とクロスプラットフォーム対応
  - 豊富なエラーハンドリング
  - 複数音源同時再生対応
- **音声フォーマット**: MP3, OGG, WAV

### 状態管理・データ

- **状態管理**: Zustand 5.x
- **データ永続化**: Tauri v2 store API
- **設定ファイル**: JSON形式

## 機能要件

### コア機能

#### 音声再生機能

- 複数音源の同時再生（最大14音源）
- 各音源の独立した音量調整（0-100%）
- ワンクリックでの再生/停止切り替え
- ループ再生（デフォルト有効）
- フェードイン/アウト（250ms）

#### プリセット音源

**自然音**

- Rain（雨音）
- Storm（嵐）
- Wind（風音）
- Waves（波音）
- Stream（小川）
- Birds（鳥のさえずり）

**人工音**

- Train（電車音）
- Boat（船音）
- City（都市音）
- Coffee Shop（カフェ音）
- Fireplace（暖炉音）

**ノイズ**

- Pink Noise（ピンクノイズ）
- White Noise（ホワイトノイズ）
- Summer Night（夏の夜音）

#### プリセット機能

- 音源組み合わせと音量設定の保存
- プリセット名の設定
- プリセットの読み込み
- プリセットの編集・削除
- 起動時の前回設定復元

### UI/UX要件

#### 操作性重視設計

**ワンタップ操作**

- 音源アイコンクリック → 即座に再生開始
- 再度クリック → 停止（トグル動作）
- スライダードラッグ → リアルタイム音量調整

**視覚的フィードバック**

- 再生中音源: アイコンのブルーグロー効果
- 停止中音源: グレーアウト表示
- 音量スライダー: リアルタイム値表示
- ホバー効果: 250ms のスムーズトランジション

**誤操作防止**

- 最小タッチエリア: 44px x 44px
- 明確な操作境界
- 操作状態の即座表示（100ms以内）

#### レスポンシブデザイン

- ウィンドウサイズ: 1200px x 800px（固定）
- 4:3のアスペクト比維持
- 高DPI対応

### システム要件

#### パフォーマンス

- **CPU使用率**: アイドル時 < 1%、再生時 < 5%
- **メモリ使用量**: < 150MB
- **起動時間**: < 2秒
- **操作レスポンス**: < 100ms
- **フレームレート**: 60fps維持

#### 安定性対策

**エラーハンドリング**

- 音声ファイル読み込み失敗時の代替処理
- ネットワークエラーの適切な表示
- 予期しないエラーからの復旧機能

**メモリ管理**

- 使用していない音源の自動アンロード
- ガベージコレクション最適化
- メモリリーク防止機構

**音声処理安定性**

- バッファアンダーラン防止
- 音声同期保証
- オーディオコンテキスト管理

## アーキテクチャ設計

### ディレクトリ構成

```
src/
├── components/           # React コンポーネント
│   ├── AudioControl/    # 音源コントロール
│   ├── VolumeSlider/    # 音量スライダー
│   └── PresetManager/   # プリセット管理
├── hooks/               # カスタムフック
├── stores/              # Zustand ストア
├── utils/               # ユーティリティ
├── types/               # TypeScript 型定義
├── assets/              # 音源ファイル・画像
└── styles/              # スタイル定義

src-tauri/
├── src/                 # Rust ソースコード
└── icons/               # アプリアイコン
```

### 状態管理設計

```typescript
interface AppState {
  // 音源状態
  audioSources: AudioSource[]
  isPlaying: Record<string, boolean>
  volumes: Record<string, number>

  // プリセット
  presets: Preset[]
  currentPreset: string | null

  // UI状態
  isLoading: boolean
  error: string | null
}
```

### 音声管理アーキテクチャ

- **AudioManager**: 全体音声制御
- **AudioSource**: 個別音源管理
- **VolumeController**: 音量制御
- **PresetController**: プリセット管理

## 開発・テスト戦略

### 開発フェーズ

1. **Phase 1**: 基本音声再生機能
2. **Phase 2**: UI実装・音量制御
3. **Phase 3**: プリセット機能
4. **Phase 4**: 最適化・安定性向上

### テスト戦略

**ユニットテスト**

- 音声制御ロジック
- 状態管理機能
- ユーティリティ関数

**統合テスト**

- 音声再生・停止
- 複数音源同時再生
- プリセット保存・復元

**パフォーマンステスト**

- 長時間稼働テスト（24時間）
- メモリリークテスト
- CPU使用率監視

### 品質保証

- TypeScript型安全性
- ESLint + Prettier
- Husky pre-commit hooks
- 自動ビルドテスト

## デプロイメント

### ビルド設定

- **ターゲット**: Windows、macOS、Linux
- **バイナリサイズ**: < 50MB
- **インストーラー**: 各OS標準形式
- **自動更新**: Tauri built-in updater

### リリース戦略

- **バージョニング**: Semantic Versioning
- **リリースサイクル**: 月次
- **ホットフィックス**: 緊急時のみ

## パフォーマンス目標

### 応答性

- UI操作レスポンス: < 100ms
- 音声開始遅延: < 200ms
- プリセット切り替え: < 500ms

### リソース効率

- メモリ使用量: < 150MB
- CPU使用率: < 5%（再生時）
- バッテリー消費: 最小限

### 安定性

- 連続稼働時間: 24時間以上
- クラッシュ率: < 0.1%
- エラー復旧: 自動
